<script>
const sheetId = "1bTIBgInp4B5I-CK1F0b55rJtlOhIza_I";
const sheetName = "Sheet1";

const csvUrl =
  `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;

const certId = new URLSearchParams(window.location.search)
  .get("id")
  ?.trim();

fetch(csvUrl)
  .then(res => res.text())
  .then(text => {
    const rows = text.split("\n").map(r => r.split(","));
    const headers = rows[0];
    const data = rows.slice(1);

    const idIndex = headers.indexOf("CERTIFICATE ID");
    const nameIndex = headers.indexOf("NAME");
    const eventIndex = headers.indexOf("EVENT");
    const dateIndex = headers.indexOf("DATE");
    const statusIndex = headers.indexOf("STATUS");

    const match = data.find(r =>
      r[idIndex]?.trim() === certId
    );

    document.getElementById("output").innerHTML = match
      ? `<b>Name:</b> ${match[nameIndex]}<br>
         <b>Event:</b> ${match[eventIndex]}<br>
         <b>Date:</b> ${match[dateIndex]}<br>
         <b>Status:</b> ${match[statusIndex]}`
      : "‚ùå Invalid Certificate";
  });
</script>
